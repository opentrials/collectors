# Tasks

build:
  - docker build -t tutum.co/roll/opentrials-scraper .

deploy:
  - ${CI?"Deployment is avaiable only on CI/CD server"}
  - docker login
    -e $OPENTRIALS_TUTUM_EMAIL
    -u $OPENTRIALS_TUTUM_USER
    -p $OPENTRIALS_TUTUM_PASS
    tutum.co
  - tutum login
    -u $OPENTRIALS_TUTUM_USER
    -p $OPENTRIALS_TUTUM_PASS
  - docker push tutum.co/roll/opentrials-scraper
  - tutum stack inspect opentrials_scraper ||
    tutum stack create --sync -f docker-compose.yml -n opentrials-scraper
  - tutum stack update --sync -f docker-compose.yml opentrials-scraper

preview:
  - docker-compose up

test:
  - pylama scraper
  - py.test -vs tests
