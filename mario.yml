# Tasks

build:
  - docker build -t opentrialsrobot/scraper .

deploy:
  - ${CI?"Deployment is avaiable only on CI/CD server"}
  - docker login
    -e $OPENTRIALS_DOCKER_EMAIL
    -u $OPENTRIALS_DOCKER_USER
    -p $OPENTRIALS_DOCKER_PASS
  - tutum login
    -u $OPENTRIALS_DOCKER_USER
    -p $OPENTRIALS_DOCKER_PASS
  - docker push opentrialsrobot/scraper
  # Entire
  - tutum stack inspect opentrials-scraper-entire ||
    tutum stack create --sync -f stacks/entire.yml -n opentrials-scraper-entire
  - tutum stack update --sync -f stacks/entire.yml opentrials-scraper-entire
  # Recent
  - tutum stack inspect opentrials-scraper-recent ||
    tutum stack create --sync -f stacks/recent.yml -n opentrials-scraper-recent
  - tutum stack update --sync -f stacks/recent.yml opentrials-scraper-recent
  # Sample
  - tutum stack inspect opentrials-scraper-sample ||
    tutum stack create --sync -f stacks/sample.yml -n opentrials-scraper-sample
  - tutum stack update --sync -f stacks/sample.yml opentrials-scraper-sample

preview:
  - docker-compose -f stacks/sample.yml up

test:
  - pylama scraper
  - py.test -vs tests
